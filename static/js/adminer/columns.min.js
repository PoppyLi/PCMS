"use strict";$(function(){ui.btn_delete(cols.url_del,"#js-cols");ui.btn_show(cols.url_show);ui.btn_delete(cols.url_ctypes_del,"#js-ctypes")});cols.get_col=function(a){console.log("get_col:");console.log(a);$.ajax({url:cols.url_cols+a.fid,type:"GET",dataType:"json",}).done(function(f){console.log("success");$("#js-box-nav-col").empty();var e;for(var d=0;d<cols.c_list.length;d++){if(cols.c_list[d].depth==a.depth){console.log(d);cols.c_list=cols.c_list.slice(0,d);if(d===0){e=cols.c_list[0]}else{e=cols.c_list[d-1]}}}cols.c_list.push(a);cols.c_now=a;$("#js-box-col ul.list-group").each(function(h,i){if($(i).attr("data-depth")>=a.depth){$(i).remove()}if($(i).attr("data-depth")<a.depth-1){$(i).hide()}if($(i).attr("data-depth")==a.depth-1){$(i).show();$(i).children("li").removeClass("active");$(i).children('li[data-id="'+a.fid+'"]').addClass("active")}});var b=template.render("tpl-cols-nav",{list:cols.c_list});$("#js-box-nav-col").append(b);var g=a;g.list_cols=f;g.baseurl=ADMINER_URL;var c=template.render("tpl-cols-show",g);$("#js-box-col").append(c).fadeIn("fast");ui.sortable(cols.url_sort,'#js-box-col ul.list-group[data-fid="'+a.fid+'"]',"asc")}).fail(function(c,e,d){var b=c.responseJSON;$.pnotify({title:"错误提示！",text:b.msg,type:"error",animation:"fade"})}).always(function(){console.log("complete")})};cols.get_ctypes=function(a){console.log("get_ctypes:");console.log(a);$.ajax({url:cols.url_types+a.cid+"/"+a.fid,type:"GET",dataType:"json",}).done(function(f){console.log("success");if(f.status==1){$("#js-box-nav-ctypes").empty();var e;for(var d=0;d<cols.ctypes_list.length;d++){if(cols.ctypes_list[d].depth==a.depth){console.log(d);cols.ctypes_list=cols.ctypes_list.slice(0,d);if(d===0){e=cols.ctypes_list[0]}else{e=cols.ctypes_list[d-1]}}}cols.ctypes_list.push(a);cols.ctypes_now=a;$("#js-box-ctypes ul.list-group").each(function(h,i){if($(i).attr("data-depth")>=a.depth){$(i).remove()}if($(i).attr("data-depth")<a.depth-1){$(i).hide()}if($(i).attr("data-depth")==a.depth-1){$(i).show();$(i).children("li").removeClass("active");$(i).children('li[data-id="'+a.fid+'"]').addClass("active")}});var b=template.render("tpl-ctypes-nav",{list:cols.ctypes_list});$("#js-box-nav-ctypes").append(b);var g=a;g.list=f.list;g.baseurl=ADMINER_URL;var c=template.render("tpl-ctypes-show",g);$("#js-box-ctypes").append(c).fadeIn("fast");ui.sortable(cols.url_ctypes_sort,'#js-box-ctypes ul.list-group[data-cid="'+a.cid+'"]',"asc")}else{console.log("err:types of "+a.cid+" is noting!")}}).fail(function(c,e,d){var b=c.responseJSON;$.pnotify({title:"错误提示！",text:b.msg,type:"error",animation:"fade"})}).always(function(){console.log("complete")})};$(function(){cols.get_col(cols.c_now);$("#js-box-nav-col").delegate("a[data-depth]","click",function(a){a.preventDefault();var d=$(this).attr("data-fid");var c=$(this).attr("data-depth");var b=$(this).attr("data-title");cols.get_col({fid:d,depth:c,title:b,identify:b})});$("#js-box-col").delegate("a.js-more","click",function(a){a.preventDefault();var d=$(this).parent().attr("data-id");var c=$(this).parent().attr("data-depth");var b=$(this).parent().attr("data-title");cols.get_col({fid:d,depth:c,title:b,identify:b})});$("#js-box-col").delegate("li","mouseenter",function(a){$(this).children("div.btn-group").fadeIn("fast")}).delegate("li","mouseleave",function(a){$(this).children("div.btn-group").fadeOut("fast")});$("#js-box-col").delegate("a.js-create","click",function(a){a.preventDefault();$('#frm-col-content input[type="submit"]').attr("value","提交");var b=$(this).parents("li");console.log(b);cols.parent_col={fid:b.attr("data-id"),depth:b.attr("data-depth"),title:b.attr("data-title"),identify:b.attr("data-identify")};document.getElementById("frm-col-content").reset();$('#frm-col-modal input[name="parent_id"]').val(cols.parent_col.fid);$("#frm-col-modal .frm-parent-title").text(cols.parent_col.title);$('#frm-col-modal input[name="id"]').remove();$("#frm-col-modal").modal()});$("#frm-col-content").on("submit",function(b){b.preventDefault();var c=$("#frm-col-content").serializeArray();var a=cols.url_col_create;if(c[c.length-1].name=="id"){a=cols.url_col_edit;$('#frm-col-content input[type="submit"]').attr("value","修改")}else{$('#frm-col-content input[type="submit"]').attr("value","提交")}$.ajax({url:a,type:"POST",dataType:"json",data:c,}).done(function(e){console.log("success");console.log(e);if(e.status){$.pnotify({title:"OK",text:e.msg,type:"success",animation:"fade"});cols.get_col(cols.parent_col);$("#frm-col-content").append('<input type="hidden" name="id" value="'+e.id+'" />');var d=$('#js-box-col li.list-group-item > div.btn-group[data-id="'+e.id+'"]');console.log(d);if(tools.isEmptyValue(d.find("a.js-more"))){d.append('<a href="#" class="btn btn-small js-more"> <i class="fa fa-folder-open"></i></a>')}$("#frm-col-modal").modal("toggle")}else{$.pnotify({title:"表单错误！",text:e.msg,type:"error",animation:"fade"})}}).fail(function(e,g,f){var d=e.responseJSON;$.pnotify({title:"错误提示！",text:d.msg,type:"error",animation:"fade"})}).always(function(){console.log("complete")});return false});$("#js-box-col").delegate("a.js-ctype","click",function(a){a.preventDefault();$("#js-box-ctypes").empty();$("#js-box-nav-ctypes").empty();cols.ctypes_now={fid:0,cid:0,depth:0,title:""};cols.ctypes_list=[];cols.parent_ctypes={fid:0,cid:0,depth:0,title:""};var b=$(this).parent("div");cols.ctypes_now.cid=b.attr("data-id");cols.ctypes_now.title=b.attr("data-title");cols.ctypes_now.fid=0;cols.ctypes_now.depth=0;$("#js-ctypes .ctypes-title").text(cols.ctypes_now.title);$("#js-ctypes").attr("data-cid",cols.ctypes_now.cid).show("fast");cols.get_ctypes(cols.ctypes_now)});$("#js-box-nav-ctypes").delegate("a[data-depth]","click",function(a){a.preventDefault();var b=$(this);cols.get_ctypes({cid:b.attr("data-cid"),depth:b.attr("data-depth"),fid:b.attr("data-fid"),title:b.attr("data-title")})});$("#js-box-nav-ctypes-create").on("click",function(a){a.preventDefault();console.log(cols.ctypes_now);cols.tmp_ctypes=cols.ctypes_now;$("#frm-ctypes-modal .frm-parent-title").text("添加分类"+cols.tmp_ctypes.title);document.getElementById("frm-ctypes-content").reset();$('#frm-ctypes-content input[type="submit"]').attr("value","提交");$('#frm-ctypes-modal input[name="fid"]').val(cols.tmp_ctypes.fid);$('#frm-ctypes-modal input[name="cid"]').val(cols.tmp_ctypes.cid);$('#frm-ctypes-modal input[name="depth"]').val(cols.tmp_ctypes.depth);$('#frm-ctypes-modal input[name="id"]').remove();$("#frm-ctypes-modal").modal()});$("#js-box-ctypes").delegate("a.js-more","click",function(a){a.preventDefault();var b=$(this).parents("li[data-id]");console.log(b.attr("data-title"));cols.get_ctypes({cid:b.attr("data-cid"),depth:b.attr("data-depth")-0+1,fid:b.attr("data-id"),title:b.attr("data-title")});console.log(cols.ctypes_list);console.log(cols.ctypes_now)});$("#js-box-ctypes").delegate("li","mouseenter",function(a){$(this).children("div.btn-group").fadeIn("fast")}).delegate("li","mouseleave",function(a){$(this).children("div.btn-group").fadeOut("fast")});$("#js-box-ctypes").delegate("a.js-create","click",function(a){a.preventDefault();var b=$(this).parents("li");console.log(b);cols.tmp_ctypes={fid:b.attr("data-id"),cid:b.attr("data-cid"),depth:b.attr("data-depth")-0+1,title:b.attr("data-title")};$("#frm-ctypes-modal .frm-parent-title").text("添加子分类"+cols.tmp_ctypes.title);document.getElementById("frm-ctypes-content").reset();$('#frm-ctypes-content input[type="submit"]').attr("value","提交");$('#frm-ctypes-modal input[name="fid"]').val(cols.tmp_ctypes.fid);$('#frm-ctypes-modal input[name="cid"]').val(cols.tmp_ctypes.cid);$('#frm-ctypes-modal input[name="depth"]').val(cols.tmp_ctypes.depth);$('#frm-ctypes-modal input[name="id"]').remove();$("#frm-ctypes-modal").modal()});$("#js-box-ctypes").delegate("a.js-edit","click",function(b){b.preventDefault();console.log("修改");var c=$(this).parents("li");var a=$(this).parents("ul");cols.tmp_ctypes={fid:a.attr("data-fid"),cid:a.attr("data-cid"),depth:a.attr("data-depth"),title:a.attr("data-title")};console.log(cols.tmp_ctypes);$("#frm-ctypes-modal .frm-parent-title").text("修改分类"+cols.tmp_ctypes.title);document.getElementById("frm-ctypes-content").reset();$('#frm-ctypes-content input[type="submit"]').attr("value","修改");$('#frm-ctypes-content input[name="title"]').val(c.attr("data-title"));$('#frm-ctypes-content input[name="fid"]').val(a.attr("data-fid"));$('#frm-ctypes-content input[name="cid"]').val(c.attr("data-cid"));$('#frm-ctypes-content input[name="depth"]').val(c.attr("data-depth"));$('#frm-ctypes-content input[name="id"]').remove();$('#frm-ctypes-content input[name="name"]').after('<input name="id" type="hidden" value="'+c.attr("data-id")+'" >');$("#frm-ctypes-modal").modal()});$("#frm-ctypes-content").on("submit",function(b){b.preventDefault();var c=$("#frm-ctypes-content").serializeArray();var a=cols.url_ctypes_create;if(c[c.length-1].name=="id"){a=cols.url_ctypes_edit;$('#frm-ctypes-content input[type="submit"]').attr("value","修改")}else{$('#frm-ctypes-content input[type="submit"]').attr("value","提交")}$.ajax({url:a,type:"POST",dataType:"json",data:c,}).done(function(e){console.log("success");console.log(e);if(e.status){$.pnotify({title:"OK",text:e.msg,type:"success",animation:"fade"});cols.get_ctypes(cols.tmp_ctypes);$('#frm-ctypes-content input[name="name"]').after('<input name="id" type="hidden" value="'+e.id+'" >');$('#frm-ctypes-content input[type="submit"]').attr("value","修改");var d=$('#js-box-ctypes li.list-group-item > div.btn-group[data-id="'+cols.tmp_ctypes.fid+'"]');if(tools.isEmptyValue(d.find("a.js-more"))){d.append('<a href="#" class="btn btn-small js-more"> <i class="fa fa-folder-open"></i></a>')}$("#frm-ctypes-modal").modal("toggle")}else{$.pnotify({title:"表单错误！",text:e.msg,type:"error",animation:"fade"})}}).fail(function(e,g,f){var d=e.responseJSON;$.pnotify({title:"错误提示！",text:d.msg,type:"error",animation:"fade"})}).always(function(){console.log("complete")});return false})});
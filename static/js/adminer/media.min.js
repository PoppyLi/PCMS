"use strict";var media={del:function(t){t&&$.ajax({type:"POST",url:UPLOADDO_URL+"delete",data:{ids:t,_cfs:$.cookie("_cfc"),_method:"DELETE"},dataType:"json"}).done(function(a){var e="error";if(0==a.status)console.log("delete error!");else{e="notie",$("#upload-modal").find('.js-goal a[data-del="'+t+'"]').parents(".js-goal").remove();var o=$(".js-goal[data-id="+t+"]").parents(".js-img-list-f").prev().find("input[type=hidden].form-upload").attr("name");media.delete2(t,o),"undefined"!=typeof media_delete&&media_delete instanceof Function&&media_delete(t,o)}$.pnotify({title:"删除文件",text:a.msg,type:e,animation:"fade"})}).fail(function(t){var a=t.responseJSON;$.pnotify({title:"错误提示！",text:a.msg,type:"error",animation:"fade"})})},delete2:function(t,a){if(0==$("input[name="+a+"]").attr("data-more"))t==$("input[name="+a+"]").val()&&($("input[name="+a+"]").val(""),$("input[name="+a+"]").next("input[name=thumb]").val("")),$("#js-"+a+"-show").find('.js-goal a[data-del="'+t+'"]').parents(".js-goal").remove();else{$("#js-"+a+"-show").find('.js-goal a[data-del="'+t+'"]').parents(".js-goal").remove();var e="";$("#js-"+a+"-show div[data-id]").each(function(t,o){0==t?($("input[name="+a+"]").next("input[name=thumb]").val($(o).attr("data-thumb")),e=$(o).attr("data-id")):$(o).attr("data-id")&&(e+=","+$(o).attr("data-id"))}),$("input[name="+a+"]").val(e)}},done:function(t,a){if(0==$("input[name="+a+"]").attr("data-more")){t.it=t.list[0];var e=template.render("tpl-photo-show",t);$("#js-"+a+"-show").html(e);var o=$("input[name="+a+"]").val();o&&media.del(o),$("input[name="+a+"]").val(t.list[0].id),$("input[name="+a+"]").next().val(t.list[0].thumb)}else{var e=template.render("tpl-photos-show",t);$("#js-"+a+"-show").append(e);var i="";$("#js-"+a+"-show div[data-id]").each(function(t,e){0==t?($("input[name="+a+"]").next("input[name=thumb]").val($(e).attr("data-thumb")),i=$(e).attr("data-id")):$(e).attr("data-id")&&(i+=","+$(e).attr("data-id"))}),$("input[name="+a+"]").val(i)}},show:function(t,a){if(t&&"undefined"!=typeof t&&!tools.isEmpty(t)){var e,o;console.log(t),t instanceof Array?(e={upload_url:UPLOAD_URL,static_url:STATIC_URL,list:t},o=template.render("tpl-photos-show",e)):(e={upload_url:UPLOAD_URL,static_url:STATIC_URL,it:t},o=template.render("tpl-photo-show",e)),$("#js-"+a+"-show").html(o)}},get_day_list:function(t,a,e){$.ajax({type:"GET",url:UPLOADDO_URL+"get_day_ajax",data:{dt:t,nocache:Math.random()},dataType:"json"}).done(function(t){var o;0==t.status?$.pnotify({title:"没有数据",text:t.msg,type:status,animation:"fade"}):(t.upload_url=UPLOAD_URL,t.static_url=STATIC_URL,t.uploado_url=UPLOADDO_URL,o=template.render(e,t)),$("#"+a).html(o)}).fail(function(t){var e=t.responseJSON;$.pnotify({title:"错误提示！",text:e.msg,type:"error",animation:"fade"}),$("#"+a).after(ui.alert("访问数据列表错误 ：<br />"+e))})},sort:function(t){$("#js-"+t+"-show").sortable({update:function(){var a="";$("#js-"+t+"-show div[data-id]").each(function(e,o){0==e?($("input[name="+t+"]").next("input[name=thumb]").val($(o).attr("data-thumb")),a=$(o).attr("data-id")):$(o).attr("data-id")&&(a+=","+$(o).attr("data-id"))}),$("input[name="+t+"]").val(a)}}).disableSelection()},set_seo:function(){}};$(function(){ui.fancybox_img(),$('input[type="file"].fileupload').fileupload({url:UPLOADDO_URL,dataType:"json",formData:{_cfs:$.cookie("_cfc")},fail:function(t){var a=t.responseJSON;$.pnotify({title:"错误",text:a+"上传错误，请联系管理员！",type:"error",animation:"fade"})},done:function(t,a){var e=a.result.files,o="FID:";if($.each(a.result.files,function(t,a){e[t].size=$.number(a.size/1024,2),o+="->"+a.id}),void 0==e[0].error){$.pnotify({title:"上传文件",text:"已经上传文件。"+o,type:"success",animation:"fade"}),$("#upload-modal").delay(1e3).hide(500);var i={upload_url:UPLOAD_URL,static_url:STATIC_URL,list:e},n=template.render("tpl-upload-list",i);$("#js-upload-list-f").prepend(n);var l=$(this).parent().next("input[type=hidden]").attr("name");media.done(i,l),"undefined"!=typeof media_done&&media_done instanceof Function&&media_done(i,l)}else $.pnotify({title:"上传失败",text:"您的文件不被允许上传，请询问管理员！",type:"error",animation:"fade"})},progressall:function(t,a){$("#upload-modal").show(300);var e=parseInt(a.loaded/a.total*100,10);$("#upload-modal .progress .progress-bar").css("width",e+"%")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"),$("#upload-modal > .upload-header > a.upload-close").on("click",function(t){t.preventDefault(),$("#upload-modal").hide(),$("#js-upload-list-f").html("")}),$("#upload-modal").delegate("li a[data-del]","click",function(t){t.preventDefault(),media.del($(this).attr("data-del"))}),$(".js-img-list-f").delegate(".js-goal a[data-del]","click",function(t){t.preventDefault(),$(this).attr("data-del")?media.del($(this).attr("data-del")):$(this).parents(".js-goal").remove()}),$(".js-img-list-f").delegate(".js-goal a[data-seo]","click",function(t){t.preventDefault();var a=$(this).attr("data-seo");$.ajax({url:UPLOADDO_URL+"get_ajax/"+a,type:"GET",dataType:"JSON"}).done(function(t){console.log("success"),console.log(t),$("#js-upload-seo-title").val(t.title),$("#js-upload-seo-alt").val(t.alt),$("#js-upload-seo-text").val(t.text),$("#js-upload-seo-name").text(t.name),$("#js-upload-seo-save").attr("data-fid",t.id),$("#js-upload-seo-modal").modal()}).fail(function(t){var a=t.responseJSON;$.pnotify({title:"错误提示！",text:a.msg,type:"error",animation:"fade"}),$("#"+domf).after(ui.alert("访问数据错误 ：<br />"+a))}).always(function(){console.log("complete")})}),$("#js-upload-seo-save").on("click",function(t){t.preventDefault();var a=$(this).attr("data-fid"),e={fid:a,alt:$("#js-upload-seo-alt").val(),title:$("#js-upload-seo-title").val(),text:$("#js-upload-seo-text").val(),_cfs:$.cookie("_cfc")};$.ajax({url:UPLOADDO_URL+"seo_ajax",type:"POST",dataType:"JSON",data:e}).done(function(t){console.log("success");var a={title:"",text:t.msg,type:"",delay:3e3};1==t.status?(a.title="成功!",a.type="success"):(a.title="错误！",a.type="error"),$.pnotify(a)}).fail(function(t){var a=t.responseJSON;$.pnotify({title:"错误提示！",text:a.msg,type:"error",animation:"fade"}),$("#"+domf).after(ui.alert("访问数据错误 ：<br />"+a))}).always(function(){console.log("complete")})})});